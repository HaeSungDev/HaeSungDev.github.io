---
title:  "베이스캠프 7주차 회고"
search: true
categories: 
  - Basecamp
last_modified_at: 2021-03-09T18:55:00
---

NHN 기술 교육 베이스캠프 7주차 회고입니다. 이번주에는 좀 버거우면서도 힘든 과제가 많았지만 많이 배울 수 있는 교육이었습니다.

## 웹 스케일 아웃

이번주에는 웹 스케일 아웃과 관련된 교육을 받고 교육 내용에 해당하는 과제를 수행했습니다. 기존에는 웹서버 한대를 가지고 서비스를 올리는 작업을 했었다면 이번에는 트래픽이 늘어서 웹서버가 여러대가 될때 어떻게 해야할지 교육을 받았습니다.

크게 두가지 정도로 접근할 수 있었는데 첫번째는 세션, 파일등의 공유 데이터를 어떻게 관리할 지에 대한 내용이었고 두번쨰는 클라이언트가 여러대의 웹서버가 있을 때 어떤 서버에 접속할 지에 대한 내용이었습니다.

세션은 공유 DB를 이용하거나 레디스 등의 공유 저장소를 이용하는 방법이 있고 파일은 NAS 등의 공유 저장소를 이용하면 된다고 교육을 받았습니다.
그리고 클라이언트가 여러대의 서버를 접근할 때는 로드밸런서를 서버들 앞에 둬서 클라이언트가 로드밸런서에 요청하면 뒷단에서 로드밸런서가 서버들에게 트래픽을 배분하는 방식으로 구현하면 된다고 교육을 받았습니다.

앞서 배운 내용을 기반으로 과제를 받았고 한주동안 과제를 수행했습니다.

## 공유 스토리지

공유 스토리지는 NHN Cloud의 Object Storage를 사용하면 됐는데 다른 조원이 빨리 작업을 해줘서 금방 끝낼 수 있었습니다.
특히 Object Storage에 접근할 때 토큰을 매번 받아오는 부분이 있었는데 원식님이 그 부분을 NHN의 Catcher라는 라이브러리로 캐싱해서 효율적으로 활용할 수 있게 바꿔줬습니다. 너무 좋은 아이디어라고 생각했습니다.

## 공유 세션 구현

공유 세션은 Redis를 이용한 방식과 DB를 이용한 방식을 구현했습니다. 기존의 Session을 사용하던 방법을 바꾸고 싶지 않아서 구현법을 찾게됐고 Spring Session 코드를 분석해서 구현을 했습니다.

이 부분은 추상화를 이용해서 같은 조원인 광현님과 작업을 같이했는데 너무 좋은 경험이었습니다. Spring Session에서 저장소를 추상화 하는 방법이 코드를 작성하는데 매우 유용했습니다.

한가지 아쉬운 점은 Spring Session에서는 Session 속성의 변화 값을 관리해서 변화 하는 부분만 저장소에 저장하는데 그 부분을 구현하기가 어려워서 매번 지우고 다시 저장하는 방식으로 구현한 부분이 좀 아쉬웠습니다.
다음에 좀 더 고도화를 하면 좋을 것 같습니다.

## NHN Cloud의 Deploy를 활용한 배포

이 부분도 다른 조원이 구현을 했는데 가장 삽질을 많이 했던 과제였습니다. 웹 서비스를 배포하는데 계속해서 인증쪽 DB에 연결되는 문제가 있었습니다.

기존에 secret이라는 프로퍼티를 따로 분리해서 DB 암호나 중요한 정보를 저장하고 있었는데 서버의 홈 디렉토리의 config 폴더 밑에 인증과 웹서비스의 secret 프로퍼티를 저장하고 빌드할 때 가져다 쓰는 방식으로 구현했었습니다.

그런데 Deploy 방식으로 배포를 하니 자꾸 인증쪽 DB에 접속이 돼서 정상적으로 웹서비스가 실행되지 않는 문제가 생겼고 수많은 삽질 결과 config 폴더 안의 secret 프로퍼티 파일이 문제라는 것을 알았습니다.

도대체 왜 이런 동작을 하나 의문이 생겨서 Spring Boot 문서를 찾아봤고 프로퍼티 파일을 찾을 때 현재 디렉토리에 있는 config 폴더가 가장 우선순위가 높은 것을 알았습니다...
따라서 인증쪽 secret 프로퍼티에 계속 붙는 문제가 있었고 폴더명을 변경하니 해결됐습니다.

## 마무리

이번주도 몰랐던 내용을 배우고 처음 해보는 것들을 해보면서 많이 배울 수 있었습니다.